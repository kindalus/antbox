openapi: 3.1.0
info:
  title: Antbox API
  version: "2.0.0"
  description: REST API for Antbox
servers:
  - url: /v2
    description: API server
security:
  - bearerAuth: []
  - cookieAuth: []
  - apiKeyHeader: []
  - apiKeyQuery: []
tags:
  - name: actions
    description: Operations related to actions
  - name: agents
    description: Operations related to AI agents
  - name: ai-models
    description: Operations related to AI models
  - name: api-keys
    description: Operations related to API keys
  - name: articles
    description: Operations related to articles (internationalized content)
  - name: aspects
    description: Operations related to aspects
  - name: audit
    description: Audit logging operations (admin-only)
  - name: docs
    description: API documentation
  - name: extensions
    description: Operations related to extensions
  - name: features
    description: Operations related to features
  - name: groups
    description: Operations related to user groups
  - name: login
    description: Authentication operations
  - name: nodes
    description: Operations related to nodes (files, folders, etc.)
  - name: notifications
    description: Operations related to user and group notifications
  - name: skills
    description: Operations related to AI agent skills
  - name: templates
    description: Operations related to templates
  - name: users
    description: Operations related to users
  - name: workflows
    description: Operations related to workflow instances
paths:
  /actions:
    get:
      tags:
        - actions
      summary: List available actions
      operationId: listActions
      responses:
        "200":
          description: A list of action nodes
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/NodeMetadata"
        default:
          $ref: "#/components/responses/Error"
  "/actions/{uuid}/-/run":
    post:
      tags:
        - actions
      summary: Run an action
      operationId: runAction
      parameters:
        - $ref: "#/components/parameters/UUID"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                uuids:
                  type: array
                  items:
                    type: string
                    format: uuid
                parameters:
                  type: object
                  additionalProperties: true
      responses:
        "200":
          description: Action executed successfully. The response shape depends on the feature's returnType (string, number, boolean, array, object, file, or void).
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/FeatureActionResult"
            application/octet-stream:
              schema:
                type: string
                format: binary
        default:
          $ref: "#/components/responses/Error"
  /agents:
    get:
      tags:
        - agents
      summary: List all agents
      operationId: listAgents
      responses:
        "200":
          description: A list of agents
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Agent"
        default:
          $ref: "#/components/responses/Error"
  "/agents/-/upload":
    post:
      tags:
        - agents
      summary: Create or replace an agent
      operationId: createOrReplaceAgent
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                file:
                  type: string
                  format: binary
                  description: A JSON file containing the agent's metadata.
      responses:
        "200":
          description: Agent created or replaced successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Agent"
        default:
          $ref: "#/components/responses/Error"
  "/agents/rag/-/chat":
    post:
      tags:
        - agents
      summary: Chat with the RAG service
      operationId: ragChat
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - text
              properties:
                text:
                  type: string
                options:
                  type: object
                  additionalProperties: true
      responses:
        "200":
          description: RAG chat response
          content:
            application/json:
              schema:
                type: object
        default:
          $ref: "#/components/responses/Error"
  "/agents/{uuid}":
    get:
      tags:
        - agents
      summary: Get an agent
      operationId: getAgent
      parameters:
        - $ref: "#/components/parameters/UUID"
      responses:
        "200":
          description: Agent details
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Agent"
        default:
          $ref: "#/components/responses/Error"
    delete:
      tags:
        - agents
      summary: Delete an agent
      operationId: deleteAgent
      parameters:
        - $ref: "#/components/parameters/UUID"
      responses:
        "204":
          description: Agent deleted successfully
        default:
          $ref: "#/components/responses/Error"
  "/agents/{uuid}/-/answer":
    post:
      tags:
        - agents
      summary: Get a structured answer from an agent
      operationId: answer
      parameters:
        - $ref: "#/components/parameters/UUID"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - text
              properties:
                text:
                  type: string
                options:
                  $ref: "#/components/schemas/AnswerOptions"
      responses:
        "200":
          description: Agent answer
          content:
            application/json:
              schema:
                type: object
        default:
          $ref: "#/components/responses/Error"
  "/agents/{uuid}/-/chat":
    post:
      tags:
        - agents
      summary: Chat with an agent
      operationId: chat
      parameters:
        - $ref: "#/components/parameters/UUID"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - text
              properties:
                text:
                  type: string
                options:
                  $ref: "#/components/schemas/ChatOptions"
      responses:
        "200":
          description: Agent chat response
          content:
            application/json:
              schema:
                type: object
        default:
          $ref: "#/components/responses/Error"
  /ai-models:
    get:
      tags:
        - ai-models
      summary: List available AI models
      operationId: listAIModels
      responses:
        "200":
          description: A list of available AI models
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/AIModel"
        default:
          $ref: "#/components/responses/Error"
  /api-keys:
    get:
      tags:
        - api-keys
      summary: List API keys
      operationId: listApiKeys
      responses:
        "200":
          description: A list of API keys
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/ApiKey"
        default:
          $ref: "#/components/responses/Error"
    post:
      tags:
        - api-keys
      summary: Create an API key
      operationId: createApiKey
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - group
              properties:
                group:
                  type: string
                  format: uuid
                description:
                  type: string
      responses:
        "201":
          description: API key created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ApiKey"
        default:
          $ref: "#/components/responses/Error"
  "/api-keys/{uuid}":
    get:
      tags:
        - api-keys
      summary: Get an API key
      operationId: getApiKey
      parameters:
        - $ref: "#/components/parameters/UUID"
      responses:
        "200":
          description: API key details
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ApiKey"
        default:
          $ref: "#/components/responses/Error"
    delete:
      tags:
        - api-keys
      summary: Delete an API key
      operationId: deleteApiKey
      parameters:
        - $ref: "#/components/parameters/UUID"
      responses:
        "204":
          description: API key deleted
        default:
          $ref: "#/components/responses/Error"
  /aspects:
    get:
      tags:
        - aspects
      summary: List aspects
      operationId: listAspects
      responses:
        "200":
          description: A list of aspects
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Aspect"
        default:
          $ref: "#/components/responses/Error"
  "/aspects/-/upload":
    post:
      tags:
        - aspects
      summary: Create or replace an aspect
      operationId: createOrReplaceAspect
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                file:
                  type: string
                  format: binary
                  description: A JSON file containing the aspect's metadata.
      responses:
        "200":
          description: Aspect created or replaced successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Aspect"
        default:
          $ref: "#/components/responses/Error"
  "/aspects/{uuid}":
    get:
      tags:
        - aspects
      summary: Get an aspect
      operationId: getAspect
      parameters:
        - $ref: "#/components/parameters/UUID"
      responses:
        "200":
          description: Aspect details
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Aspect"
        default:
          $ref: "#/components/responses/Error"
    delete:
      tags:
        - aspects
      summary: Delete an aspect
      operationId: deleteAspect
      parameters:
        - $ref: "#/components/parameters/UUID"
      responses:
        "204":
          description: Aspect deleted
        default:
          $ref: "#/components/responses/Error"
  "/aspects/{uuid}/-/export":
    get:
      tags:
        - aspects
      summary: Export an aspect
      operationId: exportAspect
      parameters:
        - $ref: "#/components/parameters/UUID"
      responses:
        "200":
          description: Aspect exported successfully
          content:
            application/json:
              schema:
                type: string
                format: binary
        default:
          $ref: "#/components/responses/Error"
  /articles:
    get:
      tags:
        - articles
      summary: List all articles
      operationId: listArticles
      responses:
        "200":
          description: A list of articles
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/RawArticleDTO"
        default:
          $ref: "#/components/responses/Error"
    post:
      tags:
        - articles
      summary: Create or replace an article
      operationId: createOrReplaceArticle
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                file:
                  type: string
                  format: binary
                  description: A JSON file containing the article's metadata with internationalized fields.
      responses:
        "200":
          description: Article created or replaced successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/RawArticleDTO"
        default:
          $ref: "#/components/responses/Error"
  "/articles/{uuid}":
    get:
      tags:
        - articles
      summary: Get an article (raw with all translations)
      operationId: getArticle
      parameters:
        - $ref: "#/components/parameters/UUID"
      responses:
        "200":
          description: Article details with all locale maps
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/RawArticleDTO"
        default:
          $ref: "#/components/responses/Error"
    delete:
      tags:
        - articles
      summary: Delete an article
      operationId: deleteArticle
      parameters:
        - $ref: "#/components/parameters/UUID"
      responses:
        "200":
          description: Article deleted successfully
        default:
          $ref: "#/components/responses/Error"
  "/articles/{uuid}/-/localized":
    get:
      tags:
        - articles
      summary: Get a localized article
      operationId: getLocalizedArticle
      description: Returns article with flattened strings based on locale fallback (requested → pt → en → first available)
      parameters:
        - $ref: "#/components/parameters/UUID"
        - name: locale
          in: query
          required: false
          schema:
            type: string
            default: pt
          description: Locale code (e.g., pt, en, fr, es)
      responses:
        "200":
          description: Localized article with flattened string fields
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/LocalizedArticleDTO"
        default:
          $ref: "#/components/responses/Error"
  "/articles/-/fid/{fid}":
    get:
      tags:
        - articles
      summary: Get a localized article by FID
      operationId: getArticleByFid
      description: Finds an article by its localized FID and returns the localized version
      parameters:
        - name: fid
          in: path
          required: true
          schema:
            type: string
          description: The friendly ID (FID) in the specified locale
        - name: locale
          in: query
          required: false
          schema:
            type: string
            default: pt
          description: Locale code (e.g., pt, en, fr, es)
      responses:
        "200":
          description: Localized article found by FID
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/LocalizedArticleDTO"
        default:
          $ref: "#/components/responses/Error"
  "/audit/{uuid}":
    get:
      tags:
        - audit
      summary: Get audit log for a node
      operationId: getAuditLog
      description: Returns all audit events for a specific node. Admin-only access.
      parameters:
        - $ref: "#/components/parameters/UUID"
        - name: mimetype
          in: query
          required: true
          schema:
            type: string
          description: The mimetype of the node (e.g., application/json, text/html)
      responses:
        "200":
          description: Audit events for the node
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/AuditEventDTO"
        "403":
          description: Forbidden - user is not an administrator
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AntboxError"
        default:
          $ref: "#/components/responses/Error"
  "/audit/-/deleted":
    get:
      tags:
        - audit
      summary: Get deleted nodes by mimetype
      operationId: getDeletedNodes
      description: Returns information about all deleted nodes of a specific mimetype. Admin-only access.
      parameters:
        - name: mimetype
          in: query
          required: true
          schema:
            type: string
          description: The mimetype to filter deleted nodes (e.g., application/json)
      responses:
        "200":
          description: List of deleted nodes
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/DeletedNodeInfo"
        "403":
          description: Forbidden - user is not an administrator
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AntboxError"
        default:
          $ref: "#/components/responses/Error"
  /docs:
    get:
      tags:
        - docs
      summary: List available documentation
      operationId: listDocs
      responses:
        "200":
          description: A list of available documentation
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/DocInfo"
        default:
          $ref: "#/components/responses/Error"
  "/docs/{uuid}":
    get:
      tags:
        - docs
      summary: Get a document
      operationId: getDoc
      parameters:
        - $ref: "#/components/parameters/UUID"
      responses:
        "200":
          description: Document content
          content:
            text/markdown:
              schema:
                type: string
            text/html:
              schema:
                type: string
        default:
          $ref: "#/components/responses/Error"
  /extensions:
    get:
      tags:
        - extensions
      summary: List all extensions
      operationId: listExtensions
      responses:
        "200":
          description: A list of extensions
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/NodeMetadata"
        default:
          $ref: "#/components/responses/Error"
  "/extensions/{uuid}/-/exec":
    get:
      tags:
        - extensions
      summary: Run an extension (GET)
      operationId: runExtensionGet
      parameters:
        - $ref: "#/components/parameters/UUID"
      responses:
        "200":
          description: Extension run result
          content:
            application/json:
              schema:
                type: object
        default:
          $ref: "#/components/responses/Error"
    post:
      tags:
        - extensions
      summary: Run an extension (POST)
      operationId: runExtension
      parameters:
        - $ref: "#/components/parameters/UUID"
      requestBody:
        content:
          application/json:
            schema:
              type: object
              additionalProperties: true
      responses:
        "200":
          description: Extension run result
          content:
            application/json:
              schema:
                type: object
        default:
          $ref: "#/components/responses/Error"
  /features:
    get:
      tags:
        - features
      summary: List features
      operationId: listFeatures
      responses:
        "200":
          description: A list of features
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/FeatureNode"
        default:
          $ref: "#/components/responses/Error"
  "/features/-/upload":
    post:
      tags:
        - features
      summary: Create or replace a feature
      operationId: createOrReplaceFeature
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                file:
                  type: string
                  format: binary
                  description: A JSON file containing the feature's metadata.
      responses:
        "200":
          description: Feature created or replaced successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/FeatureNode"
        default:
          $ref: "#/components/responses/Error"
  "/features/{uuid}":
    get:
      tags:
        - features
      summary: Get a feature
      operationId: getFeature
      parameters:
        - $ref: "#/components/parameters/UUID"
      responses:
        "200":
          description: Feature details
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/FeatureNode"
        default:
          $ref: "#/components/responses/Error"
    delete:
      tags:
        - features
      summary: Delete a feature
      operationId: deleteFeature
      parameters:
        - $ref: "#/components/parameters/UUID"
      responses:
        "204":
          description: Feature deleted
        default:
          $ref: "#/components/responses/Error"
  "/features/{uuid}/-/export":
    get:
      tags:
        - features
      summary: Export a feature
      operationId: exportFeature
      parameters:
        - $ref: "#/components/parameters/UUID"
      responses:
        "200":
          description: Feature exported successfully
          content:
            application/json:
              schema:
                type: string
                format: binary
        default:
          $ref: "#/components/responses/Error"
  /groups:
    get:
      tags:
        - groups
      summary: List groups
      operationId: listGroups
      responses:
        "200":
          description: A list of groups
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/NodeMetadata"
        default:
          $ref: "#/components/responses/Error"
    post:
      tags:
        - groups
      summary: Create a group
      operationId: createGroup
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - title
              properties:
                title:
                  type: string
                description:
                  type: string
      responses:
        "201":
          description: Group created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/NodeMetadata"
        default:
          $ref: "#/components/responses/Error"
  "/groups/{uuid}":
    get:
      tags:
        - groups
      summary: Get a group
      operationId: getGroup
      parameters:
        - $ref: "#/components/parameters/UUID"
      responses:
        "200":
          description: Group details
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/NodeMetadata"
        default:
          $ref: "#/components/responses/Error"
    delete:
      tags:
        - groups
      summary: Delete a group
      operationId: deleteGroup
      parameters:
        - $ref: "#/components/parameters/UUID"
      responses:
        "204":
          description: Group deleted
        default:
          $ref: "#/components/responses/Error"
  "/login/root":
    post:
      tags:
        - login
      summary: Root login
      operationId: rootLogin
      requestBody:
        required: true
        content:
          text/plain:
            schema:
              type: string
              description: SHA-256 encoded root password
      responses:
        "200":
          description: Login successful. Returns JWT in response body and sets HTTP-only cookie.
          headers:
            Set-Cookie:
              description: HTTP-only authentication cookie (token=<jwt>)
              schema:
                type: string
                example: "token=<jwt>; HttpOnly; Secure; SameSite=Strict; Path=/; Max-Age=14400"
          content:
            application/json:
              schema:
                type: object
                properties:
                  jwt:
                    type: string
                    description: JWT token valid for 4 hours
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AntboxError"
  "/login/logout":
    post:
      tags:
        - login
      summary: Logout
      operationId: logout
      description: Clears the authentication cookie. Can be called with any authentication method.
      responses:
        "200":
          description: Logout successful
          headers:
            Set-Cookie:
              description: Expired cookie to clear authentication
              schema:
                type: string
                example: "token=; HttpOnly; Secure; SameSite=Strict; Path=/; Max-Age=0"
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Logged out successfully"
  "/login/me":
    get:
      tags:
        - login
      summary: Get current authenticated user
      operationId: getCurrentUser
      security:
        - bearerAuth: []
        - cookieAuth: []
        - apiKeyHeader: []
        - apiKeyQuery: []
      responses:
        "200":
          description: Returns the authenticated user's profile
          content:
            application/json:
              schema:
                type: object
                properties:
                  email:
                    type: string
                    format: email
                  name:
                    type: string
                  groups:
                    type: array
                    items:
                      type: string
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AntboxError"
  /nodes:
    get:
      tags:
        - nodes
      summary: List nodes
      operationId: listNodes
      parameters:
        - name: parent
          in: query
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: A list of nodes
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/NodeMetadata"
        default:
          $ref: "#/components/responses/Error"
    post:
      tags:
        - nodes
      summary: Create a node
      operationId: createNode
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/NodeMetadata"
      responses:
        "201":
          description: Node created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/NodeMetadata"
        default:
          $ref: "#/components/responses/Error"
  "/nodes/-/find":
    post:
      tags:
        - nodes
      summary: Find nodes
      operationId: findNodes
      requestBody:
        required: true
        content:
          application/json:
            schema:
              oneOf:
                - type: string
                - $ref: "#/components/schemas/NodeFilters"
              pageSize:
                type: integer
              pageToken:
                type: string
      responses:
        "200":
          description: A list of nodes
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/NodeMetadata"
        default:
          $ref: "#/components/responses/Error"
  "/nodes/-/upload":
    post:
      tags:
        - nodes
      summary: Create a file node
      operationId: createFileNode
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required:
                - metadata
                - file
              properties:
                metadata:
                  $ref: "#/components/schemas/NodeMetadata"
                file:
                  type: string
                  format: binary
      responses:
        "201":
          description: File node created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/NodeMetadata"
        default:
          $ref: "#/components/responses/Error"
  "/nodes/{uuid}":
    get:
      tags:
        - nodes
      summary: Get a node
      operationId: getNode
      parameters:
        - $ref: "#/components/parameters/UUID"
      responses:
        "200":
          description: Node details
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/NodeMetadata"
        default:
          $ref: "#/components/responses/Error"
    patch:
      tags:
        - nodes
      summary: Update a node
      operationId: updateNode
      parameters:
        - $ref: "#/components/parameters/UUID"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/NodeMetadata"
      responses:
        "200":
          description: Node updated
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/NodeMetadata"
        default:
          $ref: "#/components/responses/Error"
    delete:
      tags:
        - nodes
      summary: Delete a node
      operationId: deleteNode
      parameters:
        - $ref: "#/components/parameters/UUID"
      responses:
        "204":
          description: Node deleted
        default:
          $ref: "#/components/responses/Error"
  "/nodes/{uuid}/-/breadcrumbs":
    get:
      tags:
        - nodes
      summary: Get node breadcrumbs
      operationId: getNodeBreadcrumbs
      parameters:
        - $ref: "#/components/parameters/UUID"
      responses:
        "200":
          description: A list of breadcrumb nodes
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/NodeMetadata"
        default:
          $ref: "#/components/responses/Error"
  "/nodes/{uuid}/-/copy":
    post:
      tags:
        - nodes
      summary: Copy a node
      operationId: copyNode
      parameters:
        - $ref: "#/components/parameters/UUID"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - to
              properties:
                to:
                  type: string
                  format: uuid
      responses:
        "200":
          description: Node copied
        default:
          $ref: "#/components/responses/Error"
  "/nodes/{uuid}/-/duplicate":
    get:
      tags:
        - nodes
      summary: Duplicate a node
      operationId: duplicateNode
      parameters:
        - $ref: "#/components/parameters/UUID"
      responses:
        "200":
          description: Node duplicated
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/NodeMetadata"
        default:
          $ref: "#/components/responses/Error"
  "/nodes/{uuid}/-/evaluate":
    get:
      tags:
        - nodes
      summary: Evaluate a smart folder
      operationId: evaluateNode
      parameters:
        - $ref: "#/components/parameters/UUID"
      responses:
        "200":
          description: A list of evaluated nodes
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/NodeMetadata"
        default:
          $ref: "#/components/responses/Error"
  "/nodes/{uuid}/-/export":
    get:
      tags:
        - nodes
      summary: Export a node
      operationId: exportNode
      parameters:
        - $ref: "#/components/parameters/UUID"
      responses:
        "200":
          description: Node content
          content:
            application/octet-stream:
              schema:
                type: string
                format: binary
        default:
          $ref: "#/components/responses/Error"
  "/nodes/{uuid}/-/lock":
    post:
      tags:
        - nodes
      summary: Lock a node
      description: Lock a node to prevent modifications by unauthorized users
      operationId: lockNode
      parameters:
        - $ref: "#/components/parameters/UUID"
      responses:
        "200":
          description: Node locked successfully
        default:
          $ref: "#/components/responses/Error"
  "/nodes/{uuid}/-/unlock":
    post:
      tags:
        - nodes
      summary: Unlock a node
      description: Unlock a previously locked node (requires authorization)
      operationId: unlockNode
      parameters:
        - $ref: "#/components/parameters/UUID"
      responses:
        "200":
          description: Node unlocked successfully
        default:
          $ref: "#/components/responses/Error"
  "/nodes/{uuid}/-/upload":
    put:
      tags:
        - nodes
      summary: Update node content
      operationId: updateNodeContent
      parameters:
        - $ref: "#/components/parameters/UUID"
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required:
                - file
              properties:
                file:
                  type: string
                  format: binary
      responses:
        "204":
          description: Content updated
        default:
          $ref: "#/components/responses/Error"
  /notifications:
    get:
      tags:
        - notifications
      summary: List notifications for current user
      operationId: listNotifications
      description: Returns all notifications accessible by the current user, including those targeting the user directly or any groups they belong to.
      responses:
        "200":
          description: A list of notifications
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Notification"
        default:
          $ref: "#/components/responses/Error"
  "/notifications/-/critical":
    post:
      tags:
        - notifications
      summary: Send a critical notification
      operationId: sendCriticalNotification
      description: Creates a CRITICAL priority notification. Must target at least one of targetUser or targetGroup.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateNotificationRequest"
      responses:
        "201":
          description: Notification created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Notification"
        default:
          $ref: "#/components/responses/Error"
  "/notifications/-/info":
    post:
      tags:
        - notifications
      summary: Send an info notification
      operationId: sendInfoNotification
      description: Creates an INFO priority notification. Must target at least one of targetUser or targetGroup.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateNotificationRequest"
      responses:
        "201":
          description: Notification created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Notification"
        default:
          $ref: "#/components/responses/Error"
  "/notifications/-/insight":
    post:
      tags:
        - notifications
      summary: Send an insight notification
      operationId: sendInsightNotification
      description: Creates an INSIGHT priority notification. Must target at least one of targetUser or targetGroup.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateNotificationRequest"
      responses:
        "201":
          description: Notification created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Notification"
        default:
          $ref: "#/components/responses/Error"
  "/notifications/-/delete":
    post:
      tags:
        - notifications
      summary: Delete notifications
      operationId: deleteNotifications
      description: Deletes notifications by UUIDs. User can only delete notifications targeting them directly or groups they belong to.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - uuids
              properties:
                uuids:
                  type: array
                  description: Array of notification UUIDs to delete
                  items:
                    type: string
                    format: uuid
      responses:
        "200":
          description: Notifications deleted successfully
        "403":
          description: Forbidden - user not authorized to delete one or more notifications
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AntboxError"
        default:
          $ref: "#/components/responses/Error"
  "/notifications/-/clear":
    post:
      tags:
        - notifications
      summary: Clear all notifications for current user
      operationId: clearAllNotifications
      description: Removes all notifications that target the current user directly. Group-targeted notifications are not affected and must be deleted individually using the delete endpoint.
      responses:
        "200":
          description: All user notifications cleared successfully
        default:
          $ref: "#/components/responses/Error"
  /skills:
    get:
      tags:
        - skills
      summary: List all skills
      operationId: listSkills
      responses:
        "200":
          description: A list of agent skills
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/AgentSkill"
        default:
          $ref: "#/components/responses/Error"
    post:
      tags:
        - skills
      summary: Create or replace a skill
      operationId: createOrReplaceSkill
      requestBody:
        required: true
        content:
          text/markdown:
            schema:
              type: string
              description: Markdown content with YAML frontmatter containing skill definition
      responses:
        "201":
          description: Skill created or replaced successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AgentSkill"
        default:
          $ref: "#/components/responses/Error"
  "/skills/{uuid}":
    get:
      tags:
        - skills
      summary: Get a skill by UUID
      operationId: getSkill
      parameters:
        - $ref: "#/components/parameters/UUID"
      responses:
        "200":
          description: Skill details
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AgentSkill"
        default:
          $ref: "#/components/responses/Error"
    delete:
      tags:
        - skills
      summary: Delete a skill
      operationId: deleteSkill
      parameters:
        - $ref: "#/components/parameters/UUID"
      responses:
        "200":
          description: Skill deleted successfully
        default:
          $ref: "#/components/responses/Error"
  "/skills/{uuid}/-/export":
    get:
      tags:
        - skills
      summary: Export a skill as markdown
      operationId: exportSkill
      parameters:
        - $ref: "#/components/parameters/UUID"
      responses:
        "200":
          description: Skill exported as markdown
          content:
            text/markdown:
              schema:
                type: string
        default:
          $ref: "#/components/responses/Error"
  /skills/-/metadata:
    get:
      tags:
        - skills
      summary: List skill metadata (Level 1)
      operationId: listSkillMetadata
      description: Returns minimal metadata for all skills. Used at agent startup for system prompt. Access control is handled at the agent level.
      responses:
        "200":
          description: List of skill metadata
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/AgentSkillMetadata"
        default:
          $ref: "#/components/responses/Error"
  "/skills/{uuid}/-/load":
    get:
      tags:
        - skills
      summary: Load skill content (Level 2 + optional Level 3)
      operationId: loadSkill
      description: Loads skill instructions. Returns Level 2 content by default. Add resource query params for Level 3 sections. The uuid is the skill name in kebab-case.
      parameters:
        - $ref: "#/components/parameters/UUID"
        - name: resource
          in: query
          required: false
          schema:
            type: array
            items:
              type: string
          description: Optional Level 3 resource slugs to include (e.g., form-filling, reference)
      responses:
        "200":
          description: Skill content in markdown format
          content:
            text/markdown:
              schema:
                type: string
        default:
          $ref: "#/components/responses/Error"
  "/skills/{uuid}/-/resources":
    get:
      tags:
        - skills
      summary: List available Level 3 resources
      operationId: listSkillResources
      description: Returns slugs of all Level 3 sections available for the skill. The uuid is the skill name in kebab-case.
      parameters:
        - $ref: "#/components/parameters/UUID"
      responses:
        "200":
          description: List of resource slugs
          content:
            application/json:
              schema:
                type: array
                items:
                  type: string
        default:
          $ref: "#/components/responses/Error"
  /templates:
    get:
      tags:
        - templates
      summary: List all templates
      operationId: listTemplates
      responses:
        "200":
          description: A list of templates
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/TemplateInfo"
        default:
          $ref: "#/components/responses/Error"
  "/templates/{uuid}":
    get:
      tags:
        - templates
      summary: Get a template
      operationId: getTemplate
      parameters:
        - $ref: "#/components/parameters/UUID"
      responses:
        "200":
          description: Template content
          content:
            text/plain:
              schema:
                type: string
        default:
          $ref: "#/components/responses/Error"
  /users:
    get:
      tags:
        - users
      summary: List users
      operationId: listUsers
      responses:
        "200":
          description: A list of users
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/NodeMetadata"
        default:
          $ref: "#/components/responses/Error"
    post:
      tags:
        - users
      summary: Create a user
      operationId: createUser
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/NodeMetadata"
      responses:
        "201":
          description: User created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/NodeMetadata"
        default:
          $ref: "#/components/responses/Error"
  "/users/{email}":
    get:
      tags:
        - users
      summary: Get a user by email
      operationId: getUserByEmail
      parameters:
        - name: email
          in: path
          required: true
          schema:
            type: string
            format: email
      responses:
        "200":
          description: User details
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/NodeMetadata"
        default:
          $ref: "#/components/responses/Error"
    patch:
      tags:
        - users
      summary: Update a user by email
      operationId: updateUserByEmail
      parameters:
        - name: email
          in: path
          required: true
          schema:
            type: string
            format: email
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/NodeMetadata"
      responses:
        "200":
          description: User updated
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/NodeMetadata"
        default:
          $ref: "#/components/responses/Error"
  "/users/{uuid}":
    delete:
      tags:
        - users
      summary: Delete a user
      operationId: deleteUser
      parameters:
        - $ref: "#/components/parameters/UUID"
      responses:
        "204":
          description: User deleted
        default:
          $ref: "#/components/responses/Error"
  /workflow-instances:
    get:
      tags:
        - workflows
      summary: Find active workflow instances
      operationId: findActiveWorkflows
      parameters:
        - name: workflowDefinitionUuid
          in: query
          schema:
            type: string
            format: uuid
          description: Optional workflow definition UUID to filter instances
      responses:
        "200":
          description: A list of active workflow instances
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/WorkflowInstance"
        default:
          $ref: "#/components/responses/Error"
  "/workflow-instances/{uuid}":
    get:
      tags:
        - workflows
      summary: Get a workflow instance by node UUID
      operationId: getWorkflowInstance
      parameters:
        - $ref: "#/components/parameters/UUID"
      responses:
        "200":
          description: Workflow instance details
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/WorkflowInstance"
        default:
          $ref: "#/components/responses/Error"
  "/workflow-instances/{uuid}/-/start":
    post:
      tags:
        - workflows
      summary: Start a workflow instance for a node
      operationId: startWorkflow
      parameters:
        - $ref: "#/components/parameters/UUID"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - workflowDefinitionUuid
              properties:
                workflowDefinitionUuid:
                  type: string
                  format: uuid
                  description: UUID of the workflow definition node
                groupsAllowed:
                  type: array
                  description: Optional override for groups allowed to view and interact with this workflow instance. If not specified, uses the workflow definition's groupsAllowed. If empty array, all users can access.
                  items:
                    type: string
                    format: uuid
      responses:
        "200":
          description: Workflow instance started successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/WorkflowInstance"
        default:
          $ref: "#/components/responses/Error"
  "/workflow-instances/{uuid}/-/transition":
    post:
      tags:
        - workflows
      summary: Transition a workflow instance to a new state
      operationId: transitionWorkflow
      parameters:
        - $ref: "#/components/parameters/UUID"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - signal
              properties:
                signal:
                  type: string
                  description: The signal/event that triggers the transition
                message:
                  type: string
                  description: Optional message describing the transition
      responses:
        "200":
          description: Workflow transitioned successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/WorkflowInstance"
        default:
          $ref: "#/components/responses/Error"
  "/workflow-instances/{uuid}/-/cancel":
    post:
      tags:
        - workflows
      summary: Cancel a running workflow instance
      description: Only the workflow owner or users in the --admins-- group can cancel a workflow instance
      operationId: cancelWorkflow
      parameters:
        - $ref: "#/components/parameters/UUID"
      responses:
        "200":
          description: Workflow cancelled successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/WorkflowInstance"
        "400":
          description: Bad request - workflow is already cancelled or not running
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AntboxError"
        "403":
          description: Forbidden - user is not the owner or admin
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AntboxError"
        default:
          $ref: "#/components/responses/Error"
  /workflow-instances/{uuid}/-/update:
    patch:
      tags:
        - workflows
      summary: Update a node involved in a workflow instance
      description: Update node metadata for a node that is part of an active workflow. Only users in groups allowed to modify in the current state can perform updates.
      operationId: updateWorkflowNode
      parameters:
        - $ref: "#/components/parameters/UUID"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/NodeMetadata"
      responses:
        "200":
          description: Node updated successfully
        "400":
          description: Bad request - workflow is cancelled or completed
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AntboxError"
        "403":
          description: Forbidden - user not allowed to modify node in current state
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AntboxError"
        default:
          $ref: "#/components/responses/Error"
  /workflow-instances/{uuid}/-/update-file:
    put:
      tags:
        - workflows
      summary: Update file content of a node involved in a workflow instance
      description: Update file content for a file node that is part of an active workflow. Only users in groups allowed to modify in the current state can perform updates.
      operationId: updateWorkflowNodeFile
      parameters:
        - $ref: "#/components/parameters/UUID"
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required:
                - file
              properties:
                file:
                  type: string
                  format: binary
      responses:
        "200":
          description: File updated successfully
        "400":
          description: Bad request - workflow is cancelled or completed
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AntboxError"
        "403":
          description: Forbidden - user not allowed to modify node in current state
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AntboxError"
        default:
          $ref: "#/components/responses/Error"
  /workflow-definitions:
    get:
      tags:
        - workflows
      summary: List all workflow definitions
      operationId: listWorkflowDefinitions
      responses:
        "200":
          description: A list of workflow definitions
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/WorkflowDefinition"
        default:
          $ref: "#/components/responses/Error"
    post:
      tags:
        - workflows
      summary: Create or replace a workflow definition
      operationId: createOrReplaceWorkflowDefinition
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - title
                - states
                - availableStateNames
              properties:
                uuid:
                  type: string
                  format: uuid
                  description: Optional UUID for update, omit for create
                title:
                  type: string
                  description: Workflow definition title
                description:
                  type: string
                  description: Workflow definition description
                states:
                  type: array
                  description: Array of workflow states
                  items:
                    $ref: "#/components/schemas/WorkflowState"
                availableStateNames:
                  type: array
                  description: Array of all state names in the workflow
                  items:
                    type: string
                filters:
                  $ref: "#/components/schemas/NodeFilters"
                  description: Optional filters to restrict which nodes can use this workflow. Empty filters allow all nodes.
                groupsAllowed:
                  type: array
                  description: Optional list of groups allowed to start and view workflow instances. If empty or omitted, all users can start and view instances.
                  items:
                    type: string
                    format: uuid
      responses:
        "200":
          description: Workflow definition created or updated successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/WorkflowDefinition"
        default:
          $ref: "#/components/responses/Error"
  "/workflow-definitions/{uuid}":
    get:
      tags:
        - workflows
      summary: Get a workflow definition
      operationId: getWorkflowDefinition
      parameters:
        - $ref: "#/components/parameters/UUID"
      responses:
        "200":
          description: Workflow definition details
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/WorkflowDefinition"
        default:
          $ref: "#/components/responses/Error"
    delete:
      tags:
        - workflows
      summary: Delete a workflow definition
      operationId: deleteWorkflowDefinition
      description: Deletes a workflow definition. Fails if active instances exist.
      parameters:
        - $ref: "#/components/parameters/UUID"
      responses:
        "204":
          description: Workflow definition deleted successfully
        "400":
          description: Cannot delete - active instances exist
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AntboxError"
        default:
          $ref: "#/components/responses/Error"
  "/workflow-definitions/{uuid}/-/export":
    get:
      tags:
        - workflows
      summary: Export a workflow definition
      operationId: exportWorkflowDefinition
      parameters:
        - $ref: "#/components/parameters/UUID"
      responses:
        "200":
          description: Workflow definition exported successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/WorkflowDefinition"
        default:
          $ref: "#/components/responses/Error"
components:
  schemas:
    AIModel:
      type: object
      required:
        - modelName
        - embeddings
        - llm
        - tools
        - files
        - reasoning
      properties:
        modelName:
          type: string
          description: Name identifier for the AI model
        embeddings:
          type: boolean
          description: Whether the model supports embeddings
        llm:
          type: boolean
          description: Whether the model supports LLM capabilities
        tools:
          type: boolean
          description: Whether the model supports tool use
        files:
          type: boolean
          description: Whether the model supports file processing
        reasoning:
          type: boolean
          description: Whether the model supports reasoning capabilities
    Agent:
      type: object
      required:
        - uuid
        - title
        - description
        - owner
        - createdTime
        - modifiedTime
        - model
        - temperature
        - maxTokens
        - reasoning
        - useTools
        - useSkills
        - systemInstructions
      properties:
        uuid:
          type: string
          format: uuid
        title:
          type: string
        description:
          type: string
        owner:
          type: string
          format: uuid
        createdTime:
          type: string
          format: date-time
        modifiedTime:
          type: string
          format: date-time
        model:
          type: string
        temperature:
          type: number
        maxTokens:
          type: integer
        reasoning:
          type: boolean
        useTools:
          type: boolean
        useSkills:
          type: boolean
          description: Whether the agent can use skills. If true and skillsAllowed is empty, the agent has access to all skills.
        skillsAllowed:
          type: array
          description: Optional list of skill UUIDs (names in kebab-case) that this agent can use. If empty and useSkills is true, all skills are available.
          items:
            type: string
        systemInstructions:
          type: string
    AgentSkill:
      type: object
      description: Agent Skill - a modular capability that extends AI Agent functionality. The uuid is the skill name in kebab-case.
      required:
        - uuid
        - title
        - description
        - content
        - createdTime
        - modifiedTime
      properties:
        uuid:
          type: string
          description: Unique identifier for the skill (same as the skill name in kebab-case, e.g., pdf-processing)
        title:
          type: string
          description: Human-readable title for the skill (derived from uuid in Title Case)
        description:
          type: string
          description: Brief description for skill discovery (<100 tokens)
        content:
          type: string
          description: Full markdown content of the skill (Level 2 + Level 3)
        createdTime:
          type: string
          format: date-time
          description: When the skill was created
        modifiedTime:
          type: string
          format: date-time
          description: When the skill was last modified
    AgentSkillMetadata:
      type: object
      description: Minimal skill metadata for discovery (Level 1)
      required:
        - uuid
        - description
      properties:
        uuid:
          type: string
          description: Unique identifier for the skill (same as the skill name in kebab-case)
        description:
          type: string
          description: Brief description for skill discovery
    ApiKey:
      type: object
      required:
        - uuid
        - group
        - owner
      properties:
        uuid:
          type: string
          format: uuid
        group:
          type: string
          format: uuid
        owner:
          type: string
          format: email
        description:
          type: string
        secret:
          type: string
    AntboxError:
      type: object
      required:
        - errorCode
        - message
      properties:
        errorCode:
          type: string
        message:
          type: string
    ApiKeyNode:
      type: object
      allOf:
        - $ref: "#/components/schemas/BaseNode"
      properties:
        group:
          type: string
          format: uuid
        secret:
          type: string
    AspectNode:
      type: object
      allOf:
        - $ref: "#/components/schemas/BaseNode"
      properties:
        filters:
          type: array
          items:
            type: object
        properties:
          type: array
          items:
            $ref: "#/components/schemas/AspectProperty"
    AspectProperty:
      type: object
      required:
        - name
        - title
        - type
      properties:
        name:
          type: string
        title:
          type: string
        type:
          type: string
          enum:
            ["uuid", "string", "number", "boolean", "object", "array", "file"]
        arrayType:
          type: string
          enum: ["string", "number", "uuid", "object"]
        stringMimetype:
          type: string
        readonly:
          type: boolean
        validationRegex:
          type: string
        validationList:
          type: array
          items:
            type: string
        validationFilters:
          type: array
          items:
            type: object
        required:
          type: boolean
        searchable:
          type: boolean
        default:
          type: object
          nullable: true
    AnswerOptions:
      type: object
      properties:
        context:
          type: object
          additionalProperties: true
    Aspect:
      type: object
      required:
        - uuid
        - title
      properties:
        uuid:
          type: string
          format: uuid
        title:
          type: string
        description:
          type: string
        filters:
          type: array
          items:
            type: array
            items:
              type: object
        properties:
          type: object
          additionalProperties:
            type: object
            properties:
              type:
                type: string
              title:
                type: string
              description:
                type: string
              required:
                type: boolean
              readonly:
                type: boolean
              default:
                type: object
    ChatOptions:
      type: object
      properties:
        context:
          type: object
          additionalProperties: true
        parent:
          type: string
          format: uuid
    DocInfo:
      type: object
      required:
        - id
        - title
        - mimetype
      properties:
        id:
          type: string
        title:
          type: string
        mimetype:
          type: string
    FeatureNode:
      type: object
      allOf:
        - $ref: "#/components/schemas/BaseNode"
      properties:
        size:
          type: integer
        name:
          type: string
        exposeAction:
          type: boolean
        runOnCreates:
          type: boolean
        runOnUpdates:
          type: boolean
        runManually:
          type: boolean
        filters:
          type: array
          items:
            type: array
            items:
              type: object
        exposeExtension:
          type: boolean
        exposeAITool:
          type: boolean
        runAs:
          type: string
        groupsAllowed:
          type: array
          items:
            type: string
            format: uuid
        parameters:
          type: array
          items:
            $ref: "#/components/schemas/FeatureParameter"
        returnType:
          type: string
          enum:
            - string
            - number
            - boolean
            - array
            - object
            - file
            - void
        returnDescription:
          type: string
        returnContentType:
          type: string
    FeatureActionResult:
      description: Result payload returned when running a feature action. The concrete shape depends on the feature's declared returnType.
      nullable: true
      oneOf:
        - type: object
        - type: array
          items: {}
        - type: string
        - type: number
        - type: boolean
    FeatureParameter:
      type: object
      required:
        - name
        - type
        - required
      properties:
        name:
          type: string
        type:
          type: string
          enum: ["string", "number", "boolean", "object", "array", "file"]
        arrayType:
          type: string
          enum: ["string", "number", "file", "object"]
        contentType:
          type: string
        required:
          type: boolean
        description:
          type: string
        defaultValue:
          type: object
          nullable: true
    FilterOperator:
      type: string
      description: The comparison or logical operator for filtering.
      enum:
        - "=="
        - "<="
        - ">="
        - "<"
        - ">"
        - "!="
        - "in"
        - "not-in"
        - "match"
        - "contains"
        - "contains-all"
        - "contains-any"
        - "not-contains"
        - "contains-none"

    NodeFilter:
      type: array
      description: A single filter tuple #: [field: string, operator: FilterOperator, value: unknown].
      # Represents a tuple (fixed length array with different types for each item)
      items:
        - type: string # field: string
        - $ref: "#/components/schemas/FilterOperator" # operator: FilterOperator
        - {} # value: unknown (empty schema allows any type)
      minItems: 3
      maxItems: 3

    NodeFilters1D:
      type: array
      description: An array of NodeFilter tuples (AND/OR logic implied by the endpoint).
      items:
        $ref: "#/components/schemas/NodeFilter"

    NodeFilters2D:
      type: array
      description: An array of NodeFilters1D arrays (representing nested logic, e.g., OR groups of AND filters).
      items:
        $ref: "#/components/schemas/NodeFilters1D"

    NodeFilters:
      description: Either a 1D array of filters or a 2D array of filters.
      oneOf:
        - $ref: "#/components/schemas/NodeFilters1D"
        - $ref: "#/components/schemas/NodeFilters2D"
    Permission:
      type: string
      enum:
        - Read
        - Write
        - Export
    Permissions:
      type: object
      properties:
        group:
          type: array
          items:
            $ref: "#/components/schemas/Permission"
        authenticated:
          type: array
          items:
            $ref: "#/components/schemas/Permission"
        anonymous:
          type: array
          items:
            $ref: "#/components/schemas/Permission"
        advanced:
          type: object
          additionalProperties:
            type: array
            items:
              $ref: "#/components/schemas/Permission"
    BaseNode:
      type: object
      required:
        - uuid
        - fid
        - title
        - mimetype
        - parent
        - createdTime
        - modifiedTime
        - owner
      properties:
        uuid:
          type: string
          format: uuid
        fid:
          type: string
        title:
          type: string
        description:
          type: string
        mimetype:
          type: string
        parent:
          type: string
          format: uuid
        createdTime:
          type: string
          format: date-time
        modifiedTime:
          type: string
          format: date-time
        owner:
          type: string
          format: email
        fulltext:
          type: string
        permissions:
          $ref: "#/components/schemas/Permissions"
        locked:
          type: boolean
          description: Indicates if the node is locked
          default: false
        lockedBy:
          type: string
          format: email
          description: Email of the user who locked the node
        unlockAuthorizedGroups:
          type: array
          items:
            type: string
            format: uuid
          description: UUIDs of groups authorized to unlock this node
          default: []
    FileNode:
      type: object
      allOf:
        - $ref: "#/components/schemas/BaseNode"
      properties:
        size:
          type: integer
        aspects:
          type: array
          items:
            type: string
            format: uuid
        properties:
          type: object
          additionalProperties: true
        tags:
          type: array
          items:
            type: string
        related:
          type: array
          items:
            type: string
            format: uuid
    FolderNode:
      type: object
      allOf:
        - $ref: "#/components/schemas/BaseNode"
      properties:
        aspects:
          type: array
          items:
            type: string
            format: uuid
        filters:
          type: array
          items:
            type: object
        group:
          type: string
          format: uuid
        onCreate:
          type: array
          items:
            type: string
        onDelete:
          type: array
          items:
            type: string
        onUpdate:
          type: array
          items:
            type: string
        permissions:
          $ref: "#/components/schemas/Permissions"
        properties:
          type: object
          additionalProperties: true
        related:
          type: array
          items:
            type: string
            format: uuid
        tags:
          type: array
          items:
            type: string
    GroupNode:
      type: object
      allOf:
        - $ref: "#/components/schemas/BaseNode"
    MetaNode:
      type: object
      allOf:
        - $ref: "#/components/schemas/BaseNode"
      properties:
        aspects:
          type: array
          items:
            type: string
            format: uuid
        properties:
          type: object
          additionalProperties: true
        related:
          type: array
          items:
            type: string
            format: uuid
        tags:
          type: array
          items:
            type: string
    SmartFolderNode:
      type: object
      allOf:
        - $ref: "#/components/schemas/BaseNode"
      properties:
        filters:
          type: array
          items:
            type: object
    UserNode:
      type: object
      allOf:
        - $ref: "#/components/schemas/BaseNode"
      properties:
        email:
          type: string
          format: email
        group:
          type: string
          format: uuid
        groups:
          type: array
          items:
            type: string
            format: uuid
    NodeLike:
      oneOf:
        - $ref: "#/components/schemas/ApiKeyNode"
        - $ref: "#/components/schemas/AspectNode"
        - $ref: "#/components/schemas/FeatureNode"
        - $ref: "#/components/schemas/FileNode"
        - $ref: "#/components/schemas/FolderNode"
        - $ref: "#/components/schemas/GroupNode"
        - $ref: "#/components/schemas/MetaNode"
        - $ref: "#/components/schemas/SmartFolderNode"
        - $ref: "#/components/schemas/UserNode"
    NodeMetadata:
      type: object
      properties:
        uuid:
          type: string
          format: uuid
        fid:
          type: string
        title:
          type: string
        name:
          type: string
        description:
          type: string
        mimetype:
          type: string
        size:
          type: integer
        parent:
          type: string
          format: uuid
        createdTime:
          type: string
          format: date-time
        modifiedTime:
          type: string
          format: date-time
        owner:
          type: string
          format: email
        aspects:
          type: array
          items:
            type: string
            format: uuid
        tags:
          type: array
          items:
            type: string
        related:
          type: array
          items:
            type: string
            format: uuid
        properties:
          type: object
          additionalProperties: true
        fulltext:
          type: string
        filters:
          type: object
        group:
          type: string
          format: uuid
        groups:
          type: array
          items:
            type: string
            format: uuid
        email:
          type: string
          format: email
        phone:
          type: string
          description: Optional phone number
        hasWhatsapp:
          type: boolean
          description: Whether the phone number has WhatsApp (always false if phone is not provided)
        secret:
          type: string
        onCreate:
          type: array
          items:
            type: string
        onUpdate:
          type: array
          items:
            type: string
        onDelete:
          type: array
          items:
            type: string
        permissions:
          $ref: "#/components/schemas/Permissions"
        runManually:
          type: boolean
        runAs:
          type: string
        parameters:
          type: array
          items:
            $ref: "#/components/schemas/FeatureParameter"
        returnType:
          type: string
          enum:
            ["string", "number", "boolean", "array", "object", "file", "void"]
        returnDescription:
          type: string
        returnContentType:
          type: string
        groupsAllowed:
          type: array
          items:
            type: string
            format: uuid
        runOnCreates:
          type: boolean
        runOnUpdates:
          type: boolean
        runOnDeletes:
          type: boolean
        exposeAction:
          type: boolean
        exposeExtension:
          type: boolean
        exposeAITool:
          type: boolean
        model:
          type: string
        temperature:
          type: number
        maxTokens:
          type: integer
        reasoning:
          type: boolean
        useTools:
          type: boolean
        systemInstructions:
          type: string
        structuredAnswer:
          type: string
    TemplateInfo:
      type: object
      required:
        - id
        - title
        - mimetype
      properties:
        id:
          type: string
        title:
          type: string
        mimetype:
          type: string
    WorkflowDefinition:
      type: object
      required:
        - uuid
        - title
        - description
        - owner
        - createdTime
        - modifiedTime
        - states
        - availableStateNames
        - filters
        - groupsAllowed
      properties:
        uuid:
          type: string
          format: uuid
          description: Unique identifier for the workflow definition
        title:
          type: string
          description: Workflow definition title
        description:
          type: string
          description: Workflow definition description
        owner:
          type: string
          format: email
          description: Email of the workflow definition owner
        createdTime:
          type: string
          format: date-time
          description: When the workflow definition was created
        modifiedTime:
          type: string
          format: date-time
          description: When the workflow definition was last modified
        states:
          type: array
          description: Array of workflow states
          items:
            $ref: "#/components/schemas/WorkflowState"
        availableStateNames:
          type: array
          description: Array of all state names in the workflow
          items:
            type: string
        filters:
          $ref: "#/components/schemas/NodeFilters"
          description: Filters to restrict which nodes can use this workflow. Empty filters allow all nodes.
        groupsAllowed:
          type: array
          description: List of groups allowed to start and view workflow instances. If empty, all users can start and view instances.
          items:
            type: string
            format: uuid
    WorkflowState:
      type: object
      required:
        - name
      properties:
        name:
          type: string
          description: Unique name of the state (e.g., "Draft", "In Review")
        isInitial:
          type: boolean
          description: Is this where new items start?
        isFinal:
          type: boolean
          description: Is the workflow complete when reaching this state?
        onEnter:
          type: array
          description: IDs/Names of actions to execute when entering this state
          items:
            type: string
        onExit:
          type: array
          description: IDs/Names of actions to execute before leaving this state
          items:
            type: string
        transitions:
          type: array
          description: The possible paths out of this state
          items:
            $ref: "#/components/schemas/WorkflowTransition"
    WorkflowTransition:
      type: object
      required:
        - signal
        - targetState
      properties:
        signal:
          type: string
          description: The signal/event name that triggers this transition
        targetState:
          type: string
          description: The name of the destination state
        filters:
          type: array
          description: Guard conditions - transition only valid if node satisfies these filters
          items:
            type: array
            items: {}
        actions:
          type: array
          description: IDs/Names of actions to execute during the transition
          items:
            type: string
        groupsAllowed:
          type: array
          description: List of groups allowed to execute this transition
          items:
            type: string
            format: uuid
    WorkflowInstance:
      type: object
      required:
        - uuid
        - workflowDefinitionUuid
        - nodeUuid
        - currentStateName
        - running
        - cancelled
        - groupsAllowed
        - owner
        - startedTime
      properties:
        uuid:
          type: string
          format: uuid
          description: Unique identifier for the workflow instance
        workflowDefinitionUuid:
          type: string
          format: uuid
          description: UUID of the workflow definition node
        nodeUuid:
          type: string
          format: uuid
          description: UUID of the node this workflow is attached to
        currentStateName:
          type: string
          description: Name of the current state in the workflow
        running:
          type: boolean
          description: Whether the workflow is still running (false when a final state is reached or cancelled)
        cancelled:
          type: boolean
          description: Whether this workflow instance has been cancelled. A cancelled workflow stops running and cannot be transitioned further.
        history:
          type: array
          description: History of state transitions
          items:
            $ref: "#/components/schemas/WorkflowTransitionHistory"
        groupsAllowed:
          type: array
          description: List of groups allowed to view and interact with this workflow instance. If empty, all users can view and interact with it. Copied from workflow definition at start time, but can be overridden.
          items:
            type: string
            format: uuid
        owner:
          type: string
          format: email
          description: Email of the user who started this workflow instance
        startedTime:
          type: string
          format: date-time
          description: Timestamp when this workflow instance was started
    WorkflowTransitionHistory:
      type: object
      required:
        - from
        - to
        - signal
        - timestamp
        - user
      properties:
        from:
          type: string
          description: Previous state name
        to:
          type: string
          description: New state name
        signal:
          type: string
          description: Signal/event that triggered the transition
        timestamp:
          type: string
          format: date-time
          description: When the transition occurred
        user:
          type: string
          format: email
          description: Email of the user who triggered the transition
        message:
          type: string
          description: Optional message describing the transition
    ArticleProperties:
      type: object
      required:
        - articleTitle
        - articleFid
        - articleResume
        - articleBody
      properties:
        articleTitle:
          type: string
          description: Article title
        articleFid:
          type: string
          description: Friendly ID (auto-generated from articleTitle if not provided)
        articleResume:
          type: string
          description: Article summary/resume
        articleBody:
          type: string
          description: Article body content
    ArticlePropertiesMap:
      type: object
      description: A map of locale codes to ArticleProperties
      additionalProperties:
        $ref: "#/components/schemas/ArticleProperties"
      example:
        pt:
          articleTitle: "Olá Mundo"
          articleFid: "ola-mundo"
          articleResume: "Este é um resumo"
          articleBody: "Conteúdo completo do artigo"
        en:
          articleTitle: "Hello World"
          articleFid: "hello-world"
          articleResume: "This is a summary"
          articleBody: "Full article content"
    RawArticleDTO:
      type: object
      required:
        - uuid
        - title
        - properties
        - articleAuthor
        - parent
        - createdTime
        - modifiedTime
        - owner
      properties:
        uuid:
          type: string
          format: uuid
          description: Unique identifier for the article
        title:
          type: string
          description: Node title (auto-generated from articleTitle in pt locale if not provided)
        description:
          type: string
          description: Optional description
        properties:
          $ref: "#/components/schemas/ArticlePropertiesMap"
          description: Article properties organized by locale
        articleAuthor:
          type: string
          description: Article author (not localized)
        parent:
          type: string
          format: uuid
          description: Parent folder UUID
        createdTime:
          type: string
          format: date-time
          description: Creation timestamp
        modifiedTime:
          type: string
          format: date-time
          description: Last modification timestamp
        owner:
          type: string
          format: email
          description: Owner email
    LocalizedArticleDTO:
      type: object
      required:
        - uuid
        - title
        - articleTitle
        - articleFid
        - articleResume
        - articleBody
        - articleAuthor
        - parent
        - createdTime
        - modifiedTime
        - owner
      properties:
        uuid:
          type: string
          format: uuid
          description: Unique identifier for the article
        title:
          type: string
          description: Node title
        description:
          type: string
          description: Optional description
        articleTitle:
          type: string
          description: Localized article title (selected by fallback logic)
        articleFid:
          type: string
          description: Localized friendly ID (selected by fallback logic)
        articleResume:
          type: string
          description: Localized article summary (selected by fallback logic)
        articleBody:
          type: string
          description: Localized article body (selected by fallback logic)
        articleAuthor:
          type: string
          description: Article author (not localized)
        parent:
          type: string
          format: uuid
          description: Parent folder UUID
        createdTime:
          type: string
          format: date-time
          description: Creation timestamp
        modifiedTime:
          type: string
          format: date-time
          description: Last modification timestamp
        owner:
          type: string
          format: email
          description: Owner email
    AuditEventDTO:
      type: object
      required:
        - streamId
        - eventId
        - eventType
        - occurredOn
        - userEmail
        - tenant
        - payload
        - sequence
      properties:
        streamId:
          type: string
          format: uuid
          description: The UUID of the node this event belongs to
        eventId:
          type: string
          format: uuid
          description: Unique identifier for this event
        eventType:
          type: string
          description: Type of event (e.g., NodeCreatedEvent, NodeUpdatedEvent, NodeDeletedEvent)
          enum:
            - NodeCreatedEvent
            - NodeUpdatedEvent
            - NodeDeletedEvent
        occurredOn:
          type: string
          format: date-time
          description: When the event occurred
        userEmail:
          type: string
          format: email
          description: Email of the user who triggered the event
        tenant:
          type: string
          description: Tenant identifier
        payload:
          type: object
          description: Event-specific payload (NodeMetadata for create/delete, NodeUpdateChanges for update)
        sequence:
          type: integer
          description: Sequence number of the event in the stream (starts at 0)
    DeletedNodeInfo:
      type: object
      required:
        - uuid
        - title
        - deletedAt
        - deletedBy
      properties:
        uuid:
          type: string
          format: uuid
          description: UUID of the deleted node
        title:
          type: string
          description: Title of the node (from creation event)
        deletedAt:
          type: string
          format: date-time
          description: When the node was deleted
        deletedBy:
          type: string
          format: email
          description: Email of the user who deleted the node
    Notification:
      type: object
      required:
        - uuid
        - priority
        - title
        - body
        - timestamp
      properties:
        uuid:
          type: string
          format: uuid
          description: Unique identifier for the notification
        targetUser:
          type: string
          format: email
          description: Target user email (optional if targetGroup is provided)
        targetGroup:
          type: string
          format: uuid
          description: Target group UUID (optional if targetUser is provided)
        priority:
          type: string
          enum:
            - CRITICAL
            - INFO
            - INSIGHT
          description: Priority level of the notification
        title:
          type: string
          description: Notification title
        body:
          type: string
          description: Notification body/message
        timestamp:
          type: string
          format: date-time
          description: When the notification was created
    CreateNotificationRequest:
      type: object
      required:
        - title
        - body
      properties:
        targetUser:
          type: string
          format: email
          description: Target user email (at least one of targetUser or targetGroup must be provided)
        targetGroup:
          type: string
          format: uuid
          description: Target group UUID (at least one of targetUser or targetGroup must be provided)
        title:
          type: string
          description: Notification title
        body:
          type: string
          description: Notification body/message
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: "JWT token in Authorization header (Priority 2)"
    cookieAuth:
      type: apiKey
      in: cookie
      name: token
      description: "JWT token in HTTP-only cookie (Priority 3). Automatically sent by browser for same-origin requests."
    apiKeyHeader:
      type: apiKey
      in: header
      name: Authorization
      description: "API key in Authorization header format: 'ApiKey <key>' (Priority 1)"
    apiKeyQuery:
      type: apiKey
      in: query
      name: api_key
      description: "API key in query parameter (Priority 4)"
  parameters:
    UUID:
      name: uuid
      in: path
      required: true
      schema:
        type: string
        format: uuid
  responses:
    Error:
      description: Error
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/AntboxError"
